mutate(model_id = c(rep("model", 1296), rep("model2", (tally(.) - 1296))),
log_terror = (exp(log_terror)-1),
log_hisppop = exp(log_hisppop)) %>%
select(rowid, predicted, log_hisppop, log_terror, model_id) %>%
mutate(predicted = (exp(predicted)/(1 + exp(predicted)))) %>%
group_by(log_hisppop, log_terror, model_id) %>%
summarise(predicted_sum = mean(predicted)) %>%
ggplot(aes(x = log_terror, y = predicted_sum, linetype = as.factor(log_hisppop))) +
geom_line() +
geom_ribbon(aes(ymin = conf.low, ymac = conf.high)) +
labs(y = '"Borders and Immigration" Grievance Probability',
x = "Number of Non-Right Wing Terror Threats or Attacks in U.S. in Previous Year") +
scale_linetype_discrete(#breaks = c(-1,0,1),
labels = c(expression("25"^{th}~"Percentile Hispanic Population in County"),
"Median Hispanic Population in County",
expression("75"^{th}~"Percentile Hispanic Population in County")),
name = "") +
theme_bw() +
theme(axis.title = element_text(face = "bold"),
legend.position = "top") +
facet_grid(~model_id,
labeller = labeller(model_id = labs))
predictions(model, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data) %>%
rbind(.,
predictions(model2, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data2)) %>%
mutate(model_id = c(rep("model", 1296), rep("model2", (tally(.) - 1296))),
log_terror = (exp(log_terror)-1),
log_hisppop = exp(log_hisppop)) %>%
select(rowid, predicted, log_hisppop, log_terror, model_id, conf.low, conf.high) %>%
mutate(predicted = (exp(predicted)/(1 + exp(predicted)))) %>%
group_by(log_hisppop, log_terror, model_id) %>%
summarise(predicted_sum = mean(predicted)) %>%
ggplot(aes(x = log_terror, y = predicted_sum, linetype = as.factor(log_hisppop))) +
geom_line() +
geom_ribbon(aes(ymin = conf.low, ymac = conf.high)) +
labs(y = '"Borders and Immigration" Grievance Probability',
x = "Number of Non-Right Wing Terror Threats or Attacks in U.S. in Previous Year") +
scale_linetype_discrete(#breaks = c(-1,0,1),
labels = c(expression("25"^{th}~"Percentile Hispanic Population in County"),
"Median Hispanic Population in County",
expression("75"^{th}~"Percentile Hispanic Population in County")),
name = "") +
theme_bw() +
theme(axis.title = element_text(face = "bold"),
legend.position = "top") +
facet_grid(~model_id,
labeller = labeller(model_id = labs))
predictions(model, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data) %>%
rbind(.,
predictions(model2, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data2)) %>%
mutate(model_id = c(rep("model", 1296), rep("model2", (tally(.) - 1296))),
log_terror = (exp(log_terror)-1),
log_hisppop = exp(log_hisppop)) %>%
select(rowid, predicted, log_hisppop, log_terror, model_id, conf.low, conf.high) %>%
mutate(predicted = (exp(predicted)/(1 + exp(predicted)))) %>%
group_by(log_hisppop, log_terror, model_id) %>%
summarise(predicted_sum = mean(predicted)) %>%
ggplot(aes(x = log_terror, y = predicted_sum, linetype = as.factor(log_hisppop))) +
geom_line() +
geom_ribbon(aes(ymin = conf.low, ymax = conf.high)) +
labs(y = '"Borders and Immigration" Grievance Probability',
x = "Number of Non-Right Wing Terror Threats or Attacks in U.S. in Previous Year") +
scale_linetype_discrete(#breaks = c(-1,0,1),
labels = c(expression("25"^{th}~"Percentile Hispanic Population in County"),
"Median Hispanic Population in County",
expression("75"^{th}~"Percentile Hispanic Population in County")),
name = "") +
theme_bw() +
theme(axis.title = element_text(face = "bold"),
legend.position = "top") +
facet_grid(~model_id,
labeller = labeller(model_id = labs))
predictions(model, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data) %>%
rbind(.,
predictions(model2, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data2)) %>%
mutate(model_id = c(rep("model", 1296), rep("model2", (tally(.) - 1296))),
log_terror = (exp(log_terror)-1),
log_hisppop = exp(log_hisppop)) %>%
select(rowid, predicted, log_hisppop, log_terror, model_id, conf.low, conf.high)
predictions(model, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data) %>%
rbind(.,
predictions(model2, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data2)) %>%
mutate(model_id = c(rep("model", 1296), rep("model2", (tally(.) - 1296))),
log_terror = (exp(log_terror)-1),
log_hisppop = exp(log_hisppop)) %>%
select(rowid, predicted, log_hisppop, log_terror, model_id, conf.low, conf.high) %>%
mutate(predicted = (exp(predicted)/(1 + exp(predicted)))) %>%
# group_by(log_hisppop, log_terror, model_id) %>%
# summarise(predicted_sum = mean(predicted)) %>%
ggplot(aes(x = log_terror, y = predicted_sum, linetype = as.factor(log_hisppop))) +
geom_line() +
geom_ribbon(aes(ymin = conf.low, ymax = conf.high)) +
labs(y = '"Borders and Immigration" Grievance Probability',
x = "Number of Non-Right Wing Terror Threats or Attacks in U.S. in Previous Year") +
scale_linetype_discrete(#breaks = c(-1,0,1),
labels = c(expression("25"^{th}~"Percentile Hispanic Population in County"),
"Median Hispanic Population in County",
expression("75"^{th}~"Percentile Hispanic Population in County")),
name = "") +
theme_bw() +
theme(axis.title = element_text(face = "bold"),
legend.position = "top") +
facet_grid(~model_id,
labeller = labeller(model_id = labs))
predictions(model, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data) %>%
rbind(.,
predictions(model2, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data2)) %>%
mutate(model_id = c(rep("model", 1296), rep("model2", (tally(.) - 1296))),
log_terror = (exp(log_terror)-1),
log_hisppop = exp(log_hisppop)) %>%
select(rowid, predicted, log_hisppop, log_terror, model_id, conf.low, conf.high) %>%
mutate(predicted = (exp(predicted)/(1 + exp(predicted)))) %>%
# group_by(log_hisppop, log_terror, model_id) %>%
# summarise(predicted_sum = mean(predicted)) %>%
ggplot(aes(x = log_terror, y = predicted, linetype = as.factor(log_hisppop))) +
geom_line() +
geom_ribbon(aes(ymin = conf.low, ymax = conf.high)) +
labs(y = '"Borders and Immigration" Grievance Probability',
x = "Number of Non-Right Wing Terror Threats or Attacks in U.S. in Previous Year") +
scale_linetype_discrete(#breaks = c(-1,0,1),
labels = c(expression("25"^{th}~"Percentile Hispanic Population in County"),
"Median Hispanic Population in County",
expression("75"^{th}~"Percentile Hispanic Population in County")),
name = "") +
theme_bw() +
theme(axis.title = element_text(face = "bold"),
legend.position = "top") +
facet_grid(~model_id,
labeller = labeller(model_id = labs))
predictions(model, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data) %>%
rbind(.,
predictions(model2, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data2)) %>%
mutate(model_id = c(rep("model", 1296), rep("model2", (tally(.) - 1296))),
log_terror = (exp(log_terror)-1),
log_hisppop = exp(log_hisppop)) %>%
select(rowid, predicted, log_hisppop, log_terror, model_id, conf.low, conf.high) %>%
mutate(predicted = (exp(predicted)/(1 + exp(predicted)))) %>%
group_by(log_hisppop, log_terror, model_id) %>%
summarise(predicted_sum = mean(predicted),
conf.low = mean(conf.low),
conf.high = mean(conf.high)) %>%
ggplot(aes(x = log_terror, y = predicted_sum, linetype = as.factor(log_hisppop))) +
geom_line() +
geom_ribbon(aes(ymin = conf.low, ymax = conf.high)) +
labs(y = '"Borders and Immigration" Grievance Probability',
x = "Number of Non-Right Wing Terror Threats or Attacks in U.S. in Previous Year") +
scale_linetype_discrete(#breaks = c(-1,0,1),
labels = c(expression("25"^{th}~"Percentile Hispanic Population in County"),
"Median Hispanic Population in County",
expression("75"^{th}~"Percentile Hispanic Population in County")),
name = "") +
theme_bw() +
theme(axis.title = element_text(face = "bold"),
legend.position = "top") +
facet_grid(~model_id,
labeller = labeller(model_id = labs))
predictions(model, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data) %>%
rbind(.,
predictions(model2, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data2)) %>%
mutate(model_id = c(rep("model", 1296), rep("model2", (tally(.) - 1296))),
log_terror = (exp(log_terror)-1),
log_hisppop = exp(log_hisppop)) %>%
select(rowid, predicted, log_hisppop, log_terror, model_id, conf.low, conf.high) %>%
mutate(predicted = (exp(predicted)/(1 + exp(predicted)))) %>%
group_by(log_hisppop, log_terror, model_id) %>%
# summarise(predicted_sum = mean(predicted),
#           conf.low = mean(conf.low),
#           conf.high = mean(conf.high)) %>%
ggplot(aes(x = log_terror, y = predicted, linetype = as.factor(log_hisppop))) +
geom_line() +
# geom_ribbon(aes(ymin = conf.low, ymax = conf.high)) +
labs(y = '"Borders and Immigration" Grievance Probability',
x = "Number of Non-Right Wing Terror Threats or Attacks in U.S. in Previous Year") +
scale_linetype_discrete(#breaks = c(-1,0,1),
labels = c(expression("25"^{th}~"Percentile Hispanic Population in County"),
"Median Hispanic Population in County",
expression("75"^{th}~"Percentile Hispanic Population in County")),
name = "") +
theme_bw() +
theme(axis.title = element_text(face = "bold"),
legend.position = "top") +
facet_grid(~model_id,
labeller = labeller(model_id = labs))
predictions(model, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data) %>%
rbind(.,
predictions(model2, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data2)) %>%
mutate(model_id = c(rep("model", 1296), rep("model2", (tally(.) - 1296))),
log_terror = (exp(log_terror)-1),
log_hisppop = exp(log_hisppop)) %>%
select(rowid, predicted, log_hisppop, log_terror, model_id, conf.low, conf.high) %>%
mutate(predicted = (exp(predicted)/(1 + exp(predicted)))) %>%
group_by(log_hisppop, log_terror, model_id)
predictions(model, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data) %>%
rbind(.,
predictions(model2, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data2)) %>%
mutate(model_id = c(rep("model", 1296), rep("model2", (tally(.) - 1296))),
log_terror = (exp(log_terror)-1),
log_hisppop = exp(log_hisppop)) %>%
select(rowid, predicted, log_hisppop, log_terror, model_id, conf.low, conf.high) %>%
mutate(predicted = (exp(predicted)/(1 + exp(predicted)))) %>%
group_by(log_hisppop, log_terror, model_id) %>%
# summarise(predicted_sum = mean(predicted),
#           conf.low = mean(conf.low),
#           conf.high = mean(conf.high)) %>%
ggplot(aes(x = log_terror, y = predicted, linetype = as.factor(log_hisppop), group = as.factor(log_hisppop))) +
geom_line() +
# geom_ribbon(aes(ymin = conf.low, ymax = conf.high)) +
labs(y = '"Borders and Immigration" Grievance Probability',
x = "Number of Non-Right Wing Terror Threats or Attacks in U.S. in Previous Year") +
scale_linetype_discrete(#breaks = c(-1,0,1),
labels = c(expression("25"^{th}~"Percentile Hispanic Population in County"),
"Median Hispanic Population in County",
expression("75"^{th}~"Percentile Hispanic Population in County")),
name = "") +
theme_bw() +
theme(axis.title = element_text(face = "bold"),
legend.position = "top") +
facet_grid(~model_id,
labeller = labeller(model_id = labs))
predictions(model, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data) %>%
rbind(.,
predictions(model2, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data2)) %>%
mutate(model_id = c(rep("model", 1296), rep("model2", (tally(.) - 1296))),
log_terror = (exp(log_terror)-1),
log_hisppop = exp(log_hisppop)) %>%
select(rowid, predicted, log_hisppop, log_terror, model_id) %>%
mutate(predicted = (exp(predicted)/(1 + exp(predicted)))) %>%
group_by(log_hisppop, log_terror, model_id) %>%
summarise(predicted_sum = mean(predicted)) %>%
ggplot(aes(x = log_terror, y = predicted_sum, linetype = as.factor(log_hisppop), group = as.factor(log_hisppop))) +
geom_line() +
labs(y = '"Borders and Immigration" Grievance Probability',
x = "Number of Non-Right Wing Terror Threats or Attacks in U.S. in Previous Year") +
scale_linetype_discrete(#breaks = c(-1,0,1),
labels = c(expression("25"^{th}~"Percentile Hispanic Population in County"),
"Median Hispanic Population in County",
expression("75"^{th}~"Percentile Hispanic Population in County")),
name = "") +
theme_bw() +
theme(axis.title = element_text(face = "bold"),
legend.position = "top") +
facet_grid(~model_id,
labeller = labeller(model_id = labs))
predictions(model, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data) %>%
rbind(.,
predictions(model2, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data2)) %>%
mutate(model_id = c(rep("model", 1296), rep("model2", (tally(.) - 1296))),
log_terror = (exp(log_terror)-1),
log_hisppop = exp(log_hisppop)) %>%
select(rowid, predicted, log_hisppop, log_terror, model_id) %>%
mutate(predicted = (exp(predicted)/(1 + exp(predicted))))
predictions(model, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data)
predictions(model, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data) %>%
rbind(.,
predictions(model2, variables = list(log_terror = seq(quantile(wno_data$log_terror, .25, na.rm = T),
quantile(wno_data$log_terror, .75, na.rm = T),
by = .25),
log_hisppop = c(quantile(wno_data$log_hisppop, .25, na.rm = T),
quantile(wno_data$log_hisppop, .5, na.rm = T),
quantile(wno_data$log_hisppop, .75, na.rm = T))),
newdata = model.data2)) %>%
mutate(model_id = c(rep("model", 1296), rep("model2", (tally(.) - 1296))),
log_terror = (exp(log_terror)-1),
log_hisppop = exp(log_hisppop)) %>%
select(rowid, predicted, log_hisppop, log_terror, model_id) %>%
mutate(predicted = (exp(predicted)/(1 + exp(predicted)))) %>%
group_by(log_hisppop, log_terror, model_id) %>%
summarise(predicted_sum = mean(predicted))
pacman::p_load(tidyverse,
tidytext,
quanteda,
tm,
readtext,
textreg,
textclean,
textstem,
stringi,
udpipe,
text2map,
stm,
Hmisc,
install = T)
data <- readtext(paste0(getwd(), "/TXTs/*"))
pre.meta <- readRDS("pre_topic_meta.rds")
#pre STM cleaning
data <- data %>%
#transliterate
mutate(text = stri_trans_general(text,
id = "Any-Latin;Latin-ASCII"),
#lowercase
text = tolower(text),
#replace curly quotes
text = replace_curly_quote(text),
#remove punctuation external to a word group
text = gsub("(\\w+[_'-]+\\w+)|[[:punct:]]+", "\\1", text),
#replace contractions
text = replace_contraction(text),
#remove numbers
text = gsub("[[:digit:]]+", " ", text),
#remove excess whitespace between words
text = gsub("[[:space:]]+", " ", text),
#remove excess whitespace at begining and end of strings
text = trimws(text))
pre.meta <- pre.meta[order(match(rownames(pre.meta), data$doc_id)),]
identical(rownames(pre.meta), data$doc_id) #should be true
pre.meta$doc_id <- paste0("doc", 1:nrow(data))
lemmas <- readRDS("lemmas.rds")
# Get triplet matrix
df <- lemmas %>% #This can take a long time
#remove words that are 2 characters long or less
filter(!nchar(lemma) <= 2) %>%
#remove English stop words in the Onix, SMART, or Snowball stop lists
anti_join(stop_words, by = c("lemma" = "word")) %>%
filter(!(lemma %in% c("page")))
# get DTM
dtm <- df %>%
cast_dtm(
document = doc_id,
term = lemma,
value = n,
weighting = tm::weightTf
)
# remove sparse terms with .4 factor
dtm <- removeSparseTerms(dtm, 0.6)
dtm
#Prep for STM
pre.meta <- pre.meta[order(match(pre.meta$doc_id, rownames(dtm))),]
identical(pre.meta$doc_id, rownames(dtm)) #should be TRUE
out <- readCorpus(dtm, type = "slam")
out <- prepDocuments(out$documents, out$vocab, pre.meta)
docs <- out$documents
vocab <- out$vocab
meta <- out$meta
identical(names(docs), meta$doc_id) #should be TRUE
# Get model
wn.stm <- stm(docs, vocab, K = 8,
prevalence =~ s(year) + ideo,
data = meta,
init.type = "Spectral")
sageLabels(wn.stm) #Topic #2 = Borders and Immigration
sageLabels(wn.stm, 20) #Topic #2 = Borders and Immigration
findThoughts(wn.stm, texts = as.character(data$text),
n = 3, topics = 7) #Topic #2 = Borders and Immigration
findThoughts(wn.stm, texts = as.character(data$text),
n = 5, topics = 7) #Topic #2 = Borders and Immigration
sageLabels(wn.stm) #Topic #2 = Borders and Immigration
sageLabels(wn.stm, 10) #Topic #2 = Borders and Immigration
findThoughts(wn.stm, texts = as.character(data$text),
n = 3, topics = 8) #Topic #2 = Borders and Immigration
# Add topic proportions to dataset
data.final <- cbind(meta, wn.stm$theta)
data.final[order(data.final$`8`, c("doc"))]
colnames(data.final)
data.final[order(data.final$`8`, c("doc_id"))] |> head()
data.final[order(data.final$`8`), c("doc_id","8"))] |> head()
data.final[order(data.final$`8`), c("doc_id","8")] |> head()
data.final[-order(data.final$`8`), c("doc_id","8")] |> head()
data.final[order(data.final$`8`, decreasing = T), c("doc_id","8")] |> head()
sageLabels(wn.stm, 10) #Topic #2 = Borders and Immigration
data.final[order(data.final$`8`, decreasing = T), c("doc_id","8")] |> head(10)
data.final[order(data.final$`8`, decreasing = T), c("doc_id","8")] |> head(15)
data.final[order(data.final$`2`, decreasing = T), c("doc_id","2")] |> head(15)
data.final[order(data.final$`2`, decreasing = T), c("doc_id","2")] |> head(30)
wno_data$hisp_pop
data.final$population
9176*1000
model
model$model |> nrow()
